<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>第 3 课：分支的奥秘 - Git 故事会</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../styles/main.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script defer src="../scripts/main.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="container mx-auto p-4 md:p-8">
    <header class="mb-6 flex items-center justify-between">
      <a href="../index.html" class="text-indigo-600 hover:underline">← 返回首页</a>
      <h1 class="text-2xl md:text-3xl font-bold text-gray-800">第 3 课：分支的奥秘</h1>
      <div></div>
    </header>

    <div class="two-cols">
      <div class="left-panel">
        <section>
          <h2>故事场景</h2>
          <div class="character-intro">
            <p>两周后，产品经理抛出一个紧急需求："我们需要一个节日主题页面！"张三马上决定："不能在 main 上直接改，开一个 <strong>feature/holiday-theme</strong> 分支，独立推进，避免影响正在上线的功能。"</p>
            <p>李四点头："那分支就像是一个平行世界，可以大胆尝试，失败了也不影响主线故事。"</p>
          </div>
        </section>

        <section>
          <h2>三明治教学法：分支的创建与切换</h2>

          <div class="step" data-state="create-branch">
            <h4>步骤一：创建新分支</h4>
            <p><strong>故事：为什么需要它？</strong></p>
            <p>在主线开发稳定的同时，团队需要并行开展新特性，创建分支可以让尝试独立进行。</p>

            <p><strong>命令解释：它是什么？</strong></p>
            <pre><code>git branch feature/user-interface
git checkout feature/user-interface</code></pre>
            <p><code>git branch</code>：创建一个名为 <code>feature/user-interface</code> 的新分支</p>
            <p><code>git checkout</code>：切换到该分支开始工作（或使用 <code>git switch</code>）</p>

            <p><strong>总结：它解决了什么根本问题？</strong></p>
            <p>把试验性的改动与主线隔离，降低风险，支持多人并行开发。</p>
          </div>

          <div class="step" data-state="branch-work">
            <h4>步骤二：在分支上工作</h4>
            <p><strong>故事：为什么需要它？</strong></p>
            <p>在独立分支上提交改动，意味着可以随时回滚或丢弃，不会污染主分支。</p>

            <p><strong>命令解释：它是什么？</strong></p>
            <pre><code>git add .
git commit -m "Add user interface components"</code></pre>
            <p><code>git add</code>：将工作区变更加入暂存区；<code>git commit</code>：记录一次快照，形成可追溯历史。</p>

            <p><strong>总结：它解决了什么根本问题？</strong></p>
            <p>在不干扰主线的前提下持续迭代，保证每次提交都可回退与审查。</p>
          </div>

          <div class="step" data-state="switch-branch">
            <h4>步骤三：切换分支</h4>
            <p><strong>故事：为什么需要它？</strong></p>
            <p>当需要回到主线修复线上问题时，切换分支能快速在不同工作流之间切换。</p>

            <p><strong>命令解释：它是什么？</strong></p>
            <pre><code>git checkout main
git switch feature/user-interface</code></pre>
            <p><code>git checkout main</code>：返回主分支；<code>git switch</code>：更现代的切换命令。</p>

            <p><strong>总结：它解决了什么根本问题？</strong></p>
            <p>让开发者可以在多个任务之间灵活切换，保证线上问题优先处理。</p>
          </div>
        </section>

        <section>
          <h2>知识点总结</h2>
          <ul>
            <li><code>git branch</code> 创建分支，<code>git checkout/switch</code> 切换分支</li>
            <li>在分支上提交能隔离风险，合并前可以反复打磨</li>
            <li>分支策略是团队并行开发的基础设施</li>
          </ul>
        </section>

        <div class="mt-8 flex justify-between">
          <a href="./lesson2.html" class="nav-button">← 上一课：连接远程仓库</a>
          <a href="./lesson4.html" class="nav-button">下一课：合并的艺术 →</a>
        </div>
      </div>
      
      <div class="right-panel">
        <div id="git-graph-container" class="git-graph"></div>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const gitStates = {
          initial: `gitGraph\n  commit id: \"c1\" msg: \"Initial commit\"`,
          'create-branch': `gitGraph\n  commit id: \"c1\" msg: \"Initial commit\"\n  branch feature/user-interface\n  checkout feature/user-interface`,
          'branch-work': `gitGraph\n  commit id: \"c1\" msg: \"Initial commit\"\n  branch feature/user-interface\n  checkout feature/user-interface\n  commit id: \"c2\" msg: \"Add UI components\"`,
          'switch-branch': `gitGraph\n  commit id: \"c1\" msg: \"Initial commit\"\n  branch feature/user-interface\n  checkout feature/user-interface\n  commit id: \"c2\" msg: \"Add UI components\"\n  checkout main\n  commit id: \"c3\" msg: \"Update README\"`,
        };
        initializeApp(gitStates);
      });
    </script>
  </div>
</body>
</html>